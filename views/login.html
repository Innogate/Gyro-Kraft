<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gyro Kraft</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <link rel="stylesheet" href="/cdn/css/main.css">
  <link rel="stylesheet" href="/cdn/css/fantasy.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"
    integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="/cdn/js/main.js"></script>
</head>

<body class="w-100 h-100">
  <style>
    #form-message.disabled {
      pointer-events: none;
      color: gray;
    }
  </style>
  <section class="bg-primary py-3 py-md-5 py-xl-8 w-100 h-100 d-flex justify-content-center align-items-center">
    <div class="container">
      <div class="row gy-4 align-items-center" id="login-box">
        <div class="col-12 col-md-6 col-xl-7 desktop-view">
          <div class="d-flex justify-content-center text-bg-primary">
            <div class="col-12 col-xl-9">
              <h2 class="">
                <img class="img-fluid rounded mb-4" style="width: 60px;" loading="lazy" src="/cdn/img/logo.png"
                  height="80" alt="BootstrapBrain Logo">
                <span class="rainbow-text-google tagesschrift-regular">
                  <span style="--i:0">G</span>
                  <span style="--i:1">y</span>
                  <span style="--i:2">r</span>
                  <span style="--i:3">o</span>
                  <span style="--i:4"> </span>
                  <span style="--i:5">K</span>
                  <span style="--i:6">r</span>
                  <span style="--i:7">a</span>
                  <span style="--i:8">f</span>
                  <span style="--i:9">t</span>
                </span>
              </h2>
              <hr class="border-primary-subtle mb-4">
              <h2 data-aos="fade-left" class="h1 mb-4">We make digital products that drive you to stand out.</h2>
              <p data-aos="fade-left" class="lead mb-5">We write words, take photos, make videos, and interact with
                artificial intelligence.
              </p>
              <div class="text-endx">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"
                  class="bi bi-grip-horizontal color-animate" viewBox="0 0 16 16">
                  <path
                    d="M2 8a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm0-3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm3 3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm0-3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm3 3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm0-3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm3 3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm0-3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm3 3a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm0-3a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-md-6 col-xl-5">
          <div class="card border-0 rounded-4">
            <div class="card-body p-3 p-md-4 p-xl-5">
              <div class="row">
                <div class="col-12">
                  <div class="mb-4">
                    <h3>Sign in</h3>
                    <p>Don't have an account? <a href="#!">Sign up</a></p>
                  </div>
                </div>
              </div>
              <form id="loginForm" action="#!" method="POST" novalidate>
                <div class="row gy-3 overflow-hidden">
                  <div class="col-12">
                    <div class="form-floating mb-3">
                      <input type="number" class="form-control" name="mobile" id="mobile" placeholder="9100001234"
                        required>
                      <label for="mobile" class="form-label">Mobile</label>
                      <div id="mobile-error" class="error-msg"></div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="form-floating mb-3">
                      <input type="password" class="form-control" name="password" id="password" placeholder="Password"
                        required>
                      <label for="password" class="form-label">Password</label>
                      <div id="password-error" class="error-msg"></div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="d-grid">
                      <button class="btn btn-primary btn-lg" type="submit">Log in now</button>
                    </div>
                  </div>
                  <div class="col-12">
                    <div id="form-message" class="text-center mt-3"></div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- OTP Box -->
      <div class="row gy-4 align-items-center" style="display: none;" id="otp-box">
        <!-- Left Column (Image & Message) -->
        <div class="col-12 col-md-6 col-xl-7 desktop-view">
          <div class="d-flex justify-content-center text-bg-primary p-4 rounded-3">
            <div class="col-12 col-xl-9 text-center">
              <img class="img-fluid rounded mb-4" style="width: 150px;" loading="lazy" src="/cdn/img/otp2.png"
                height="90" alt="Logo">
              <hr class="border-primary-subtle mb-4">
              <h2 data-aos="fade-left" class="h1 mb-4"  data-aos="fade-left" >OTP will be sent to your WhatsApp</h2>
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="bi bi-grip-horizontal color-animate"
                viewBox="0 0 16 16">
                <path
                  d="M2 8a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM2 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM5 8a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM5 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM8 8a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM8 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM11 8a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM11 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM14 8a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM14 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
              </svg>
            </div>
          </div>
        </div>

        <!-- Right Column (Form) -->
        <div class="col-12 col-md-6 col-xl-5"  data-aos="fade-up" >
          <div class="card border-0 rounded-4 shadow h-100">
            <div class="card-body p-4">
              <div class="text-center mb-4">
                <img data-aos="flip-right" class="img-fluid rounded mb-3" style="width: 90px;" loading="lazy"
                  src="/cdn/img/otp.png" height="80" alt="OTP">
                <h5 class="fw-bold">Account Verification</h5>
              </div>

              <form id="loginOTPForm" novalidate>
                <div class="d-flex justify-content-between gap-2 mb-4" id="otp-inputs">
                  <!-- OTP Input Fields -->
                  <input type="text" class="form-control text-center fs-4" maxlength="1" inputmode="numeric"
                    pattern="[0-9]*" required>
                  <input type="text" class="form-control text-center fs-4" maxlength="1" inputmode="numeric"
                    pattern="[0-9]*" required>
                  <input type="text" class="form-control text-center fs-4" maxlength="1" inputmode="numeric"
                    pattern="[0-9]*" required>
                  <input type="text" class="form-control text-center fs-4" maxlength="1" inputmode="numeric"
                    pattern="[0-9]*" required>
                  <input type="text" class="form-control text-center fs-4" maxlength="1" inputmode="numeric"
                    pattern="[0-9]*" required>
                  <input type="text" class="form-control text-center fs-4" maxlength="1" inputmode="numeric"
                    pattern="[0-9]*" required>
                </div>

                <div class="d-grid mb-3">
                  <button class="btn btn-primary btn-lg" type="button" onclick="otpSubmit();">Verify Code</button>
                </div>
                <div class="text-center">
                  <a id="otp-resend" class="text-decoration-none disabled text-black-50">Resend OTP</a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>

  <script>
    $(document).ready(function () {
      $('#loginForm').on('submit', function (e) {
        e.preventDefault();

        // Clear old messages
        $('.error-msg').text('');
        $('#form-message').removeClass('error-msg success-msg').text('');

        const mobile = $('#mobile').val().trim();
        const password = $('#password').val().trim();
        let hasError = false;

        // Client-side validation
        if (mobile === '' || mobile.length !== 10) {
          $('#mobile-error').text('Enter a valid 10-digit mobile number.');
          hasError = true;
        }

        if (password.length < 6) {
          $('#password-error').text('Password must be at least 6 characters.');
          hasError = true;
        }

        if (hasError) return;

        // Send AJAX request
        $.ajax({
          url: '/login',  // Replace with your backend endpoint
          type: 'POST',
          data: {
            mobile: mobile,
            password: password
          },
          dataType: 'json',
          success: function (response) {
            if (response.success) {
              // do display none login-box and display flex opt-box
              $('#login-box').css('display', 'none');
              $('#otp-box').css('display', 'flex');
              startCountdown(30);
              // $('#form-message').addClass('success-msg').text(response.message);
            } else {
              // $('#form-message').addClass('error-msg').text( || 'Login failed.');
              swal("Login Error", response.message, "error");
            }
          },
          error: function () {
            $('#form-message').addClass('error-msg').text('Server error. Please try again later.');
          }
        });
      });
    });


    const $inputs = $("#otp-inputs input");

    // Auto-move and backspace handling
    $inputs.on("input", function () {
      const $this = $(this);
      const index = $inputs.index(this);

      if ($this.val().length > 1) {
        $this.val($this.val().slice(0, 1));
      }

      if ($this.val() && index < $inputs.length - 1) {
        $inputs.eq(index + 1).focus();
      }
    });

    $inputs.on("keydown", function (e) {
      const $this = $(this);
      const index = $inputs.index(this);

      if (e.key === "Backspace" && !$this.val() && index > 0) {
        $inputs.eq(index - 1).focus();
      }
    });


    function otpSubmit() {
      let otp = "";
      $inputs.each(function () {
        otp += $(this).val().trim();
      });

      if (otp.length !== 6 || !/^\d{6}$/.test(otp)) {
        alert("Please enter a valid 6-digit OTP.");
        return;
      }

      $.ajax({
        url: "/login/otp",
        method: "POST",
        data: {
            "otp": otp
          },
        success: function (res) {
          console.log(res);
          if (res.success) {
            window.location.href = "/";
          }else{
            swal("Login Error", res.message, "error");
          }
          
        },
        error: function (xhr) {
          alert("Invalid OTP. Please try again.");
        }
      });
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
    crossorigin="anonymous"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

</body>

</html>